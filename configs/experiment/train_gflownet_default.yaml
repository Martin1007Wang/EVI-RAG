# @package _global_

# 共用的 GFlowNet 训练模板；数据集由具体 experiment 覆盖。
defaults:
  - override /data: gflownet
  - override /model: gflownet_module
  - override /callbacks: default
  - override /logger: wandb
  - override /trainer: gpu

task_name: "gflownet_train"
tags: ["gflownet"]
train: true
test: true
ckpt_path: null
seed: 42
optimized_metric: "val/rollout_reward"

# 打开 GFlowNet 专用 debug 日志（独立文件 logs/gflownet_debug.log）。
# 训练提速默认关闭，如需对拍再显式打开。
gflownet_debug: false
# 若需环境内对拍 success/hit（首图详细命中日志），打开 env_debug；默认关闭以减少日志开销。
env_debug: false

# Ensure validation runs every epoch for early stopping/monitoring.
trainer:
  check_val_every_n_epoch: 1

# Override callback monitors for GFlowNet (no ranking/mrr available)
callbacks:
  model_checkpoint:
    monitor: val/rollout_reward
    mode: max
    filename: "epoch_{epoch:03d}"
    auto_insert_metric_name: False
  early_stopping:
    monitor: val/rollout_reward
    mode: max
    patience: 50

# Residual GFlowNet：PF 以 retriever 分数为 base；在该“显式轨迹状态”定义下 P_B 为确定性回退（log P_B=0），使用 SubTB（无辅助项）。
