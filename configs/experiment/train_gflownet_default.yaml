# @package _global_

# 共用的 GFlowNet 训练模板；数据集由具体 experiment 覆盖。
defaults:
  - override /data: gflownet
  - override /model: gflownet_module
  - override /callbacks: default
  - override /logger: wandb
  - override /trainer: gpu

task_name: "gflownet_train"
tags: ["gflownet"]
train: true
test: true
ckpt_path: null
seed: 42
optimized_metric: "val/rollout_reward"

# 打开 GFlowNet 专用 debug 日志（独立文件 logs/gflownet_debug.log）。
gflownet_debug: true
# 若需环境内对拍 success/hit（首图详细命中日志），打开 env_debug
env_debug: true

# Ensure validation runs every epoch for early stopping/monitoring.
trainer:
  check_val_every_n_epoch: 1

# Override callback monitors for GFlowNet (no ranking/mrr available)
callbacks:
  model_checkpoint:
    monitor: val/rollout_reward
    mode: max
    filename: "epoch_{epoch:03d}"
    auto_insert_metric_name: False
  early_stopping:
    monitor: val/rollout_reward
    mode: max
    patience: 50

# Soft prior 默认偏弱并可调；如需关闭先验，将 retriever_prior_alpha 设为 0。
model:
  training_cfg:
    retriever_prior_alpha: 2.0
    retriever_prior_anneal:
      start: 2.0
      end: 0.5
      steps: 10000
    gt_loss_weight: 0.15
