# @package _global_
#
# GFlowNet training (single recommended config).

defaults:
  - override /data: gflownet
  - override /model: gflownet_module
  - override /callbacks: default
  - override /logger: wandb
  - override /trainer: gpu

task_name: "gflownet_train"
tags: ["gflownet"]
train: true
test: true
ckpt_path: null
seed: 42
optimized_metric: "val/answer_hit"

ckpt:
  retriever: ${oc.env:RETRIEVER_CKPT,null}

trainer:
  check_val_every_n_epoch: 1

model:
  training_cfg:
    num_train_rollouts: 1
    bc_weight: 0.7
    bc_weight_floor: 0.05
    bc_hold_ratio: 0.1
    bc_decay_ratio: 0.5

  optimizer_cfg:
    type: adamw
    lr: 1.0e-4
    weight_decay: 1.0e-4

  scheduler_cfg:
    type: cosine_restart
    t_0: 10
    t_mult: 2
    eta_min: 1.0e-6
    interval: epoch

  evaluation_cfg:
    num_eval_rollouts: 10
    rollout_temperature: 1.0

  env_cfg:
    max_steps: 3

  actor_cfg:
    policy_temperature: 1.0

  reward_cfg:
    semantic_coef: 1.0
    length_coef: 1.0


callbacks:
  model_checkpoint:
    monitor: val/answer_hit
    mode: max
    filename: "epoch_{epoch:03d}"
    auto_insert_metric_name: False
    save_weights_only: True
  early_stopping:
    monitor: val/answer_hit
    mode: max
    patience: 50
