# https://hydra.cc/docs/configure_hydra/intro/

# enable color logging
defaults:
  - override hydra_logging: colorlog
  - override job_logging: colorlog

# output directory, generated dynamically on each run (experiment/task + dataset)
run:
  dir: ${paths.log_dir}/${oc.select:hydra.runtime.choices.experiment,${task_name}}_${oc.select:hydra.runtime.choices.dataset,${oc.select:dataset.name,unknown}}/runs/${now:%Y-%m-%d}_${now:%H-%M-%S}
sweep:
  dir: ${paths.log_dir}/${oc.select:hydra.runtime.choices.experiment,${task_name}}_${oc.select:hydra.runtime.choices.dataset,${oc.select:dataset.name,unknown}}/multiruns/${now:%Y-%m-%d}_${now:%H-%M-%S}
  subdir: ${hydra.job.num}

job_logging:
  handlers:
    file:
      # Incorporates fix from https://github.com/facebookresearch/hydra/pull/2242
      # NOTE: `task_name` may contain `/` (e.g., "eval/retriever"), which would be interpreted as a subdirectory
      # and crash unless we pre-create it. Use a safe filename; the run directory already encodes the experiment.
      filename: ${hydra.runtime.output_dir}/${hydra.job.name}.log
