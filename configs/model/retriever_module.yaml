# configs/model/retriever_module.yaml

_target_: src.models.retriever_module.RetrieverModule

compile_model: true
compile_dynamic: true

retriever:
  _target_: src.models.components.retriever.Retriever
  emb_dim: 1024
  hidden_dim: 1024
  num_topics: ${dataset.num_topics}
  topic_pe: true
  direction_mode: bidirectional
  dde_cfg:
    num_rounds: ${dataset.topic_pe.num_rounds}
    num_reverse_rounds: ${dataset.topic_pe.num_reverse_rounds}
  dropout_p: 0.1
  hide_seek_cfg:
    enabled: true
    p_near: 0.7
    p_far: 0.1
    bias_near: -2.0
    bias_far: -0.5
    apply_in_eval: false

loss:
  _target_: src.losses.retriever_loss.RetrieverLoss
  path_weight: 0
  path_warmup_steps: 0
  infonce_temperature: 0.07
  infonce_weight: 1.0
  bce_weight: 0.0
  edge_weight_near: 1.0
  edge_weight_bridge: 1.0

optimizer_cfg:
  type: adamw
  lr: 1.0e-3
  weight_decay: 1.0e-4

scheduler_cfg:
  type: cosine
  t_max: 200
  eta_min: 1.0e-6
  interval: epoch
  monitor: val/answer/reachability@100

evaluation_cfg:
  edge_recall_k: ${window.k_values}
  connectivity_k: ${window.k_values}
  bridge_metrics: true
  bridge_recall_k: ${window.k_values}
  emit_predict_outputs: false
  metrics_enabled: true
  feature_metrics: false
  ablate_topic: false
