# GAgent materialization callback (predict-only).

g_agent_materializer:
  _target_: src.callbacks.g_agent_materializer.GAgentMaterializationCallback
  settings:
    _target_: src.data.components.g_agent_builder.GAgentSettings
    enabled: ${oc.select:run.build_g_agent,true}
    # Dataset-dependent knobs are bound from the experiment (eval_retriever.yaml).
    # Global top-k edges kept after score ranking.
    edge_top_k: ${run.edge_top_k}
    # Per-start-node keep ratio (ceil(deg * ratio) with caps).
    start_keep_ratio: ${oc.select:run.start_keep_ratio,0.25}
    start_min_edges: ${oc.select:run.start_min_edges,1}
    # start_max_edges: null -> defaults to edge_top_k in settings.
    start_max_edges: ${oc.select:run.start_max_edges,null}
    # Hop radius for shortest-path filtering on the selected edge space.
    max_hops: ${run.max_hops}
    score_temperature: ${run.score_temperature}
    score_mode: ${oc.select:run.edge_score_mode,"node_softmax"}
    allow_empty_answer: ${oc.select:run.allow_empty_answer,false}
    output_path: ${dataset.artifact_dir}/g_agent/${run.split}_g_agent.pt
  lmdb_path: ${dataset.paths.embeddings}/${run.split}.lmdb
  aux_lmdb_path: ${dataset.paths.embeddings}/${run.split}.aux.lmdb
