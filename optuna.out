[32m[I 2025-12-24 16:07:06,832][0m A new study created in memory with name: gflownet_optuna[0m
[[36m2025-12-24 16:07:06,832[0m][[35mHYDRA[0m] Study name: gflownet_optuna[0m
[[36m2025-12-24 16:07:06,832[0m][[35mHYDRA[0m] Storage: None[0m
[[36m2025-12-24 16:07:06,832[0m][[35mHYDRA[0m] Sampler: TPESampler[0m
[[36m2025-12-24 16:07:06,832[0m][[35mHYDRA[0m] Directions: ['maximize'][0m
[[36m2025-12-24 16:07:06,835[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 16:07:06,835[0m][[35mHYDRA[0m] 	#0 : model.actor_cfg.action_topk=100 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=0.00011973917635685035 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 16:07:06,963[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 16:07:06,965[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 16:07:06,965[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 100                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.00011973917635685035                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 16:07:07,004[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 16:07:07,004[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 16:07:07,266[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 16:07:07,409[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 16:07:07,409[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 16:07:07,410[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 16:07:07,411[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 16:07:07,411[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 16:07:07,411[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 16:07:07,412[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 16:07:07,412[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 16:07:07,449[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 16:07:09,370[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 16:07:11,462[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 16:07:11,932[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 16:07:12,869[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 16:07:12,874[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/model_summary/model_summary.py:231: Precision 16-mixed is not supported by the model summary.  Estimated model size in MB will not be accurate. Using 32 bits instead.
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/connectors/data_connector.py:377: You have overridden `transfer_batch_to_device` in `LightningModule` but have passed in a `LightningDataModule`. It will use the implementation from `LightningModule` instance.
Epoch 175/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:06 â€¢        3.39it/s train/loss: 1.824
                                     0:00:00                   train/log_reward:
                                                               -1.304           
                                                               train/answer_hit:
                                                               0.504            
[[36m2025-12-24 16:30:44,892[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 16:30:45,905[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/0/checkpoints/epoch_125.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/0/checkpoints/epoch_125.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.7053737044334412     â”‚
â”‚    test/answer_hit@10     â”‚    0.7053737044334412     â”‚
â”‚     test/length_mean      â”‚     2.218035936355591     â”‚
â”‚      test/log_reward      â”‚    -2.191288948059082     â”‚
â”‚         test/loss         â”‚    3.3479912281036377     â”‚
â”‚        test/pos_f1        â”‚    0.3479233980178833     â”‚
â”‚    test/pos_precision     â”‚    0.5737080574035645     â”‚
â”‚      test/pos_recall      â”‚    0.3430126905441284     â”‚
â”‚      test/subtb_loss      â”‚    3.3479912281036377     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.99it/s 
[[36m2025-12-24 16:30:54,416[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/0/checkpoints/epoch_125.ckpt[0m
[[36m2025-12-24 16:30:54,417[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/0[0m
[[36m2025-12-24 16:30:55,136[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.7020407915115356>[0m
[[36m2025-12-24 16:30:55,139[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 16:30:55,140[0m][[35mHYDRA[0m] 	#1 : model.actor_cfg.action_topk=200 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=0.00010043328925547804 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 16:30:55,267[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 16:30:55,269[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 16:30:55,270[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 200                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.00010043328925547804                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 16:30:55,304[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 16:30:55,304[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 16:30:55,308[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 16:30:55,399[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 16:30:55,400[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 16:30:55,401[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 16:30:55,402[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 16:30:55,402[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 16:30:55,402[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 16:30:55,402[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 16:30:55,402[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 16:30:55,412[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 16:30:57,395[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 16:30:59,451[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 16:30:59,992[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 16:31:00,927[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 16:31:00,932[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/model_summary/model_summary.py:231: Precision 16-mixed is not supported by the model summary.  Estimated model size in MB will not be accurate. Using 32 bits instead.
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 52/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:07 â€¢ 0:00:00 3.15it/s train/loss: 2.768
                                                               train/log_reward:
                                                               -2.272           
                                                               train/answer_hit:
                                                               0.361            
[[36m2025-12-24 16:38:32,443[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 16:38:33,483[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/1/checkpoints/epoch_002.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/1/checkpoints/epoch_002.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.6917850375175476     â”‚
â”‚    test/answer_hit@10     â”‚    0.6917850375175476     â”‚
â”‚     test/length_mean      â”‚    1.6991970539093018     â”‚
â”‚      test/log_reward      â”‚    -2.9233691692352295    â”‚
â”‚         test/loss         â”‚     8.670034408569336     â”‚
â”‚        test/pos_f1        â”‚    0.2994372248649597     â”‚
â”‚    test/pos_precision     â”‚    0.4998970925807953     â”‚
â”‚      test/pos_recall      â”‚    0.30962541699409485    â”‚
â”‚      test/subtb_loss      â”‚     8.670034408569336     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.90it/s 
[[36m2025-12-24 16:38:42,323[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/1/checkpoints/epoch_002.ckpt[0m
[[36m2025-12-24 16:38:42,324[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/1[0m
[[36m2025-12-24 16:38:42,324[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6612244844436646>[0m
[[36m2025-12-24 16:38:42,328[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 16:38:42,328[0m][[35mHYDRA[0m] 	#2 : model.actor_cfg.action_topk=200 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=4.75110946773562e-05 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 16:38:42,457[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 16:38:42,458[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 16:38:42,458[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 200                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 4.75110946773562e-05                                              
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 16:38:42,493[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 16:38:42,493[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 16:38:42,496[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 16:38:42,595[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 16:38:42,596[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 16:38:42,597[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 16:38:42,597[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 16:38:42,598[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 16:38:42,598[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 16:38:42,598[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 16:38:42,598[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 16:38:42,607[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 16:38:44,630[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 16:38:46,681[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 16:38:47,247[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 16:38:48,182[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 16:38:48,189[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 103/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:07 â€¢        3.15it/s train/loss: 2.638
                                     0:00:00                   train/log_reward:
                                                               -2.242           
                                                               train/answer_hit:
                                                               0.364            
[[36m2025-12-24 16:53:34,439[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 16:53:35,479[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/2/checkpoints/epoch_053.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/2/checkpoints/epoch_053.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚     0.640518844127655     â”‚
â”‚    test/answer_hit@10     â”‚     0.640518844127655     â”‚
â”‚     test/length_mean      â”‚    1.9240272045135498     â”‚
â”‚      test/log_reward      â”‚    -2.6542601585388184    â”‚
â”‚         test/loss         â”‚     3.751701593399048     â”‚
â”‚        test/pos_f1        â”‚    0.31156209111213684    â”‚
â”‚    test/pos_precision     â”‚    0.5118386149406433     â”‚
â”‚      test/pos_recall      â”‚    0.3192308843135834     â”‚
â”‚      test/subtb_loss      â”‚     3.751701593399048     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.86it/s 
[[36m2025-12-24 16:53:44,602[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/2/checkpoints/epoch_053.ckpt[0m
[[36m2025-12-24 16:53:44,603[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/2[0m
[[36m2025-12-24 16:53:44,603[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6489796042442322>[0m
[[36m2025-12-24 16:53:44,607[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 16:53:44,607[0m][[35mHYDRA[0m] 	#3 : model.actor_cfg.action_topk=400 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=0.00019298279978549677 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 16:53:44,736[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 16:53:44,737[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 16:53:44,737[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 400                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.00019298279978549677                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 16:53:44,772[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 16:53:44,772[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 16:53:44,775[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 16:53:44,870[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 16:53:44,870[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 16:53:44,872[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 16:53:44,872[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 16:53:44,873[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 16:53:44,873[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 16:53:44,873[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 16:53:44,873[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 16:53:44,885[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 16:53:46,927[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 16:53:49,061[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 16:53:49,638[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 16:53:50,593[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 16:53:50,602[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 79/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:07 â€¢ 0:00:00 3.04it/s train/loss: 2.077
                                                               train/log_reward:
                                                               -1.867           
                                                               train/answer_hit:
                                                               0.429            
[[36m2025-12-24 17:05:38,689[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 17:05:39,986[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/3/checkpoints/epoch_029.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/3/checkpoints/epoch_029.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.6652254462242126     â”‚
â”‚    test/answer_hit@10     â”‚    0.6652254462242126     â”‚
â”‚     test/length_mean      â”‚    2.0247066020965576     â”‚
â”‚      test/log_reward      â”‚     -2.55527925491333     â”‚
â”‚         test/loss         â”‚    3.6593706607818604     â”‚
â”‚        test/pos_f1        â”‚    0.3199654817581177     â”‚
â”‚    test/pos_precision     â”‚    0.5234712958335876     â”‚
â”‚      test/pos_recall      â”‚    0.3255116045475006     â”‚
â”‚      test/subtb_loss      â”‚    3.6593706607818604     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:07 â€¢ 0:00:00 1.81it/s 
[[36m2025-12-24 17:05:49,455[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/3/checkpoints/epoch_029.ckpt[0m
[[36m2025-12-24 17:05:49,456[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/3[0m
[[36m2025-12-24 17:05:49,456[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6897959113121033>[0m
[[36m2025-12-24 17:05:49,461[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 17:05:49,461[0m][[35mHYDRA[0m] 	#4 : model.actor_cfg.action_topk=200 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=5.4437884060470725e-05 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 17:05:49,592[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 17:05:49,593[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 17:05:49,593[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 200                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 5.4437884060470725e-05                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 17:05:49,628[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 17:05:49,628[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 17:05:49,632[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 17:05:49,734[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 17:05:49,735[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 17:05:49,736[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 17:05:49,736[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 17:05:49,737[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 17:05:49,737[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 17:05:49,737[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 17:05:49,737[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 17:05:49,746[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 17:05:51,512[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 17:05:53,781[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 17:05:54,246[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 17:05:55,193[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 17:05:55,198[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 55/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:07 â€¢ 0:00:00 3.16it/s train/loss: 3.165
                                                               train/log_reward:
                                                               -2.349           
                                                               train/answer_hit:
                                                               0.347            
[[36m2025-12-24 17:13:54,356[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 17:13:55,400[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/4/checkpoints/epoch_005.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/4/checkpoints/epoch_005.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.6769610643386841     â”‚
â”‚    test/answer_hit@10     â”‚    0.6769610643386841     â”‚
â”‚     test/length_mean      â”‚     1.733168601989746     â”‚
â”‚      test/log_reward      â”‚    -2.897634983062744     â”‚
â”‚         test/loss         â”‚     8.223404884338379     â”‚
â”‚        test/pos_f1        â”‚    0.3012397587299347     â”‚
â”‚    test/pos_precision     â”‚     0.505250096321106     â”‚
â”‚      test/pos_recall      â”‚    0.3075191080570221     â”‚
â”‚      test/subtb_loss      â”‚     8.223404884338379     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.89it/s 
[[36m2025-12-24 17:14:04,266[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/4/checkpoints/epoch_005.ckpt[0m
[[36m2025-12-24 17:14:04,267[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/4[0m
[[36m2025-12-24 17:14:04,267[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6489796042442322>[0m
[[36m2025-12-24 17:14:04,271[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 17:14:04,271[0m][[35mHYDRA[0m] 	#5 : model.actor_cfg.action_topk=50 model.reward_cfg.shaping_coef=1.0 model.optimizer_cfg.lr=0.00023547706014478086 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 17:14:04,400[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 17:14:04,401[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 17:14:04,401[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 1.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 50                                                       
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.00023547706014478086                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 17:14:04,436[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 17:14:04,436[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 17:14:04,439[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 17:14:04,529[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 17:14:04,529[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 17:14:04,531[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 17:14:04,531[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 17:14:04,531[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 17:14:04,532[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 17:14:04,532[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 17:14:04,532[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 17:14:04,541[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 17:14:06,606[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 17:14:08,711[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 17:14:09,203[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 17:14:10,136[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 17:14:10,140[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 111/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:06 â€¢        3.61it/s train/loss: 1.239
                                     0:00:00                   train/log_reward:
                                                               -2.227           
                                                               train/answer_hit:
                                                               0.482            
[[36m2025-12-24 17:28:18,827[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 17:28:19,866[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/5/checkpoints/epoch_061.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/5/checkpoints/epoch_061.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.7368746399879456     â”‚
â”‚    test/answer_hit@10     â”‚    0.7368746399879456     â”‚
â”‚     test/length_mean      â”‚     2.148857355117798     â”‚
â”‚      test/log_reward      â”‚    -2.7691898345947266    â”‚
â”‚         test/loss         â”‚     2.071967124938965     â”‚
â”‚        test/pos_f1        â”‚    0.3424723744392395     â”‚
â”‚    test/pos_precision     â”‚    0.5753551721572876     â”‚
â”‚      test/pos_recall      â”‚    0.34696483612060547    â”‚
â”‚      test/subtb_loss      â”‚     2.071967124938965     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 2.11it/s 
[[36m2025-12-24 17:28:27,979[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/5/checkpoints/epoch_061.ckpt[0m
[[36m2025-12-24 17:28:27,980[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/5[0m
[[36m2025-12-24 17:28:27,980[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.7510204315185547>[0m
[[36m2025-12-24 17:28:27,985[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 17:28:27,985[0m][[35mHYDRA[0m] 	#6 : model.actor_cfg.action_topk=100 model.reward_cfg.shaping_coef=2.0 model.optimizer_cfg.lr=0.0002022361383210829 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 17:28:28,119[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 17:28:28,120[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 17:28:28,120[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 2.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 100                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.0002022361383210829                                             
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 17:28:28,155[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 17:28:28,155[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 17:28:28,158[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 17:28:28,264[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 17:28:28,264[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 17:28:28,266[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 17:28:28,266[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 17:28:28,266[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 17:28:28,267[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 17:28:28,267[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 17:28:28,267[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 17:28:28,276[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 17:28:30,308[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 17:28:32,373[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 17:28:32,912[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 17:28:33,878[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 17:28:33,887[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
`Trainer.fit` stopped: `max_epochs=200` reached.
Epoch 199/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:06 â€¢        3.40it/s train/loss: 1.107
                                     0:00:00                   train/log_reward:
                                                               -2.145           
                                                               train/answer_hit:
                                                               0.469            
[[36m2025-12-24 17:55:12,315[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 17:55:13,345[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/6/checkpoints/epoch_160.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/6/checkpoints/epoch_160.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.6998146772384644     â”‚
â”‚    test/answer_hit@10     â”‚    0.6998146772384644     â”‚
â”‚     test/length_mean      â”‚    2.2711551189422607     â”‚
â”‚      test/log_reward      â”‚    -2.6982192993164062    â”‚
â”‚         test/loss         â”‚    2.0609192848205566     â”‚
â”‚        test/pos_f1        â”‚    0.3226032257080078     â”‚
â”‚    test/pos_precision     â”‚    0.5406630039215088     â”‚
â”‚      test/pos_recall      â”‚    0.3298230469226837     â”‚
â”‚      test/subtb_loss      â”‚    2.0609192848205566     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.99it/s 
[[36m2025-12-24 17:55:21,841[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/6/checkpoints/epoch_160.ckpt[0m
[[36m2025-12-24 17:55:21,842[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/6[0m
[[36m2025-12-24 17:55:21,842[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.7020407915115356>[0m
[[36m2025-12-24 17:55:21,846[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 17:55:21,846[0m][[35mHYDRA[0m] 	#7 : model.actor_cfg.action_topk=200 model.reward_cfg.shaping_coef=2.0 model.optimizer_cfg.lr=4.7406395592311655e-05 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 17:55:21,972[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 17:55:21,973[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 17:55:21,973[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 2.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 200                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 4.7406395592311655e-05                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 17:55:22,008[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 17:55:22,008[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 17:55:22,011[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 17:55:22,115[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 17:55:22,115[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 17:55:22,116[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 17:55:22,117[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 17:55:22,117[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 17:55:22,117[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 17:55:22,117[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 17:55:22,117[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 17:55:22,126[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 17:55:24,173[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 17:55:26,131[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 17:55:26,635[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 17:55:27,591[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 17:55:27,599[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 59/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:07 â€¢ 0:00:00 3.19it/s train/loss: 2.375
                                                               train/log_reward:
                                                               -3.010           
                                                               train/answer_hit:
                                                               0.302            
[[36m2025-12-24 18:03:56,754[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 18:03:57,771[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/7/checkpoints/epoch_009.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/7/checkpoints/epoch_009.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚    0.6578134894371033     â”‚
â”‚    test/answer_hit@10     â”‚    0.6578134894371033     â”‚
â”‚     test/length_mean      â”‚     1.733168601989746     â”‚
â”‚      test/log_reward      â”‚    -3.3161072731018066    â”‚
â”‚         test/loss         â”‚     7.146688461303711     â”‚
â”‚        test/pos_f1        â”‚    0.2750798761844635     â”‚
â”‚    test/pos_precision     â”‚    0.4728226959705353     â”‚
â”‚      test/pos_recall      â”‚    0.28316736221313477    â”‚
â”‚      test/subtb_loss      â”‚     7.146688461303711     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 1.90it/s 
[[36m2025-12-24 18:04:06,660[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/7/checkpoints/epoch_009.ckpt[0m
[[36m2025-12-24 18:04:06,661[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/7[0m
[[36m2025-12-24 18:04:06,661[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6000000238418579>[0m
[[36m2025-12-24 18:04:06,665[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 18:04:06,665[0m][[35mHYDRA[0m] 	#8 : model.actor_cfg.action_topk=100 model.reward_cfg.shaping_coef=0.0 model.optimizer_cfg.lr=0.00021888937469133481 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 18:04:06,794[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 18:04:06,795[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 18:04:06,795[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 0.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 100                                                      
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 0.00021888937469133481                                            
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 18:04:06,831[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 18:04:06,831[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 18:04:06,834[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 18:04:06,939[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 18:04:06,939[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 18:04:06,940[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 18:04:06,941[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 18:04:06,941[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 18:04:06,941[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 18:04:06,941[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 18:04:06,941[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 18:04:06,950[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 18:04:08,971[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 18:04:10,928[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 18:04:11,421[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 18:04:12,383[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 18:04:12,392[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 95/199 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 22/22 0:00:06 â€¢ 0:00:00 3.41it/s train/loss: 1.110
                                                               train/log_reward:
                                                               -2.873           
                                                               train/answer_hit:
                                                               0.376            
[[36m2025-12-24 18:16:59,336[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting testing![0m
[[36m2025-12-24 18:17:00,379[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_agent.pt: 1619 samples.[0m
Restoring states from the checkpoint path at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/8/checkpoints/epoch_045.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loaded model weights from the checkpoint at /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/8/checkpoints/epoch_045.ckpt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        Test metric        â”ƒ       DataLoader 0        â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚      test/answer_hit      â”‚     0.661519467830658     â”‚
â”‚    test/answer_hit@10     â”‚     0.661519467830658     â”‚
â”‚     test/length_mean      â”‚     2.181593656539917     â”‚
â”‚      test/log_reward      â”‚    -3.1977345943450928    â”‚
â”‚         test/loss         â”‚     2.014739990234375     â”‚
â”‚        test/pos_f1        â”‚    0.3059893548488617     â”‚
â”‚    test/pos_precision     â”‚    0.5145151615142822     â”‚
â”‚      test/pos_recall      â”‚    0.3115004301071167     â”‚
â”‚      test/subtb_loss      â”‚     2.014739990234375     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Testing â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 13/13 0:00:06 â€¢ 0:00:00 2.00it/s 
[[36m2025-12-24 18:17:08,920[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Best ckpt path: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/8/checkpoints/epoch_045.ckpt[0m
[[36m2025-12-24 18:17:08,921[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/8[0m
[[36m2025-12-24 18:17:08,921[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Retrieved metric value! <val/answer_hit=0.6693877577781677>[0m
[[36m2025-12-24 18:17:08,925[0m][[35mHYDRA[0m] Launching 1 jobs locally[0m
[[36m2025-12-24 18:17:08,925[0m][[35mHYDRA[0m] 	#9 : model.actor_cfg.action_topk=50 model.reward_cfg.shaping_coef=5.0 model.optimizer_cfg.lr=8.898896996100196e-05 experiment=train_gflownet hparams_search=gflownet_optuna dataset=webqsp ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt logger=none[0m
[[36m2025-12-24 18:17:09,053[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Enforcing tags! <cfg.extras.enforce_tags=True>[0m
[[36m2025-12-24 18:17:09,054[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] torch.set_float32_matmul_precision(high)[0m
[[36m2025-12-24 18:17:09,055[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Printing config tree with Rich! <cfg.extras.print_config=True>[0m
CONFIG
â”œâ”€â”€ data
â”‚   â””â”€â”€ _target_: src.data.g_agent_datamodule.GAgentDataModule                  
â”‚       cache_paths:                                                            
â”‚         train: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g
â”‚         validation: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/va
â”‚         test: /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/test_g_a
â”‚       prefer_jsonl: true                                                      
â”‚       convert_pt_to_jsonl: true                                               
â”‚       batch_size: 128                                                         
â”‚       num_workers: 8                                                          
â”‚       pin_memory: true                                                        
â”‚       drop_last: false                                                        
â”‚       persistent_workers: true                                                
â”‚       prefetch_factor: 4                                                      
â”‚       shuffle_train: true                                                     
â”‚       drop_unreachable: false                                                 
â”‚       resources:                                                              
â”‚         vocabulary_path: /mnt/data/retrieval_dataset/webqsp/materialized/vocab
â”‚         embeddings_dir: /mnt/data/retrieval_dataset/webqsp/materialized/embedd
â”‚                                                                               
â”œâ”€â”€ model
â”‚   â””â”€â”€ _target_: src.models.gflownet_module.GFlowNetModule                     
â”‚       _recursive_: false                                                      
â”‚       hidden_dim: 1024                                                        
â”‚       env_cfg:                                                                
â”‚         _target_: src.models.components.gflownet_env.GraphEnv                 
â”‚         max_steps: 3                                                          
â”‚       policy_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_policy.GFlowNetEdgePolicy    
â”‚         hidden_dim: 1024                                                      
â”‚         dropout: 0.1                                                          
â”‚         direction_vocab_size: 2                                               
â”‚       reward_cfg:                                                             
â”‚         _target_: src.models.components.gflownet_rewards.GFlowNetReward       
â”‚         success_reward: 1.0                                                   
â”‚         failure_reward: 0.01                                                  
â”‚         shaping_coef: 5.0                                                     
â”‚       actor_cfg:                                                              
â”‚         _target_: src.models.components.gflownet_actor.GFlowNetActor          
â”‚         policy_temperature: 1.0                                               
â”‚         action_topk: 50                                                       
â”‚       embedder_cfg:                                                           
â”‚         _target_: src.models.components.gflownet_embedder.GraphEmbedder       
â”‚         hidden_dim: 1024                                                      
â”‚         projector_checkpoint: logs/train_retriever_default/runs/2025-12-24_13-
â”‚         allow_deferred_init: false                                            
â”‚       state_encoder_cfg:                                                      
â”‚         _target_: src.models.components.state_encoder.StateEncoder            
â”‚         hidden_dim: 1024                                                      
â”‚         max_steps: 3                                                          
â”‚       estimator_cfg:                                                          
â”‚         _target_: src.models.components.gflownet_estimator.GFlowNetEstimator  
â”‚         hidden_dim: 1024                                                      
â”‚         zero_init_last: true                                                  
â”‚       training_cfg:                                                           
â”‚         num_train_rollouts: 2                                                 
â”‚       evaluation_cfg:                                                         
â”‚         num_eval_rollouts: 10                                                 
â”‚         rollout_temperature: 1.0                                              
â”‚       optimizer_cfg:                                                          
â”‚         type: adamw                                                           
â”‚         lr: 8.898896996100196e-05                                             
â”‚         weight_decay: 0.0001                                                  
â”‚       scheduler_cfg:                                                          
â”‚         type: cosine                                                          
â”‚         t_max: 200                                                            
â”‚         eta_min: 1.0e-06                                                      
â”‚         interval: epoch                                                       
â”‚         monitor: val/answer_hit@1                                             
â”‚       logging_cfg:                                                            
â”‚         train_prog_bar:                                                       
â”‚         - log_reward                                                          
â”‚         - answer_hit                                                          
â”‚         eval_prog_bar:                                                        
â”‚         - answer_hit@1                                                        
â”‚         log_on_step_train: false                                              
â”‚                                                                               
â”œâ”€â”€ callbacks
â”‚   â””â”€â”€ model_checkpoint:                                                       
â”‚         _target_: lightning.pytorch.callbacks.ModelCheckpoint                 
â”‚         dirpath: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025
â”‚         filename: epoch_{epoch:03d}                                           
â”‚         monitor: val/answer_hit                                               
â”‚         verbose: false                                                        
â”‚         save_last: true                                                       
â”‚         save_top_k: 1                                                         
â”‚         mode: max                                                             
â”‚         auto_insert_metric_name: false                                        
â”‚         save_weights_only: true                                               
â”‚         every_n_train_steps: null                                             
â”‚         train_time_interval: null                                             
â”‚         every_n_epochs: null                                                  
â”‚         save_on_train_epoch_end: null                                         
â”‚       early_stopping:                                                         
â”‚         _target_: lightning.pytorch.callbacks.EarlyStopping                   
â”‚         monitor: val/answer_hit                                               
â”‚         min_delta: 0.0                                                        
â”‚         patience: 50                                                          
â”‚         verbose: false                                                        
â”‚         mode: max                                                             
â”‚         strict: true                                                          
â”‚         check_finite: true                                                    
â”‚         stopping_threshold: null                                              
â”‚         divergence_threshold: null                                            
â”‚         check_on_train_epoch_end: null                                        
â”‚       model_summary:                                                          
â”‚         _target_: lightning.pytorch.callbacks.RichModelSummary                
â”‚         max_depth: -1                                                         
â”‚       rich_progress_bar:                                                      
â”‚         _target_: lightning.pytorch.callbacks.RichProgressBar                 
â”‚                                                                               
â”œâ”€â”€ logger
â”‚   â””â”€â”€ {}                                                                      
â”‚                                                                               
â”œâ”€â”€ trainer
â”‚   â””â”€â”€ _target_: lightning.pytorch.trainer.Trainer                             
â”‚       default_root_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiru
â”‚       min_epochs: 0                                                           
â”‚       max_epochs: 200                                                         
â”‚       accelerator: gpu                                                        
â”‚       devices: 1                                                              
â”‚       precision: 16-mixed                                                     
â”‚       gradient_clip_val: 1.0                                                  
â”‚       check_val_every_n_epoch: 1                                              
â”‚       log_every_n_steps: 1                                                    
â”‚       deterministic: false                                                    
â”‚                                                                               
â”œâ”€â”€ paths
â”‚   â””â”€â”€ root_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚       data_dir: /mnt/data/retrieval_dataset                                   
â”‚       log_dir: /mnt/wangjingxiong/EVI-RAG/logs/                               
â”‚       output_dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/202
â”‚       work_dir: /mnt/wangjingxiong/EVI-RAG                                    
â”‚                                                                               
â”œâ”€â”€ extras
â”‚   â””â”€â”€ ignore_warnings: false                                                  
â”‚       enforce_tags: true                                                      
â”‚       print_config: true                                                      
â”‚       torch_float32_matmul_precision: high                                    
â”‚                                                                               
â”œâ”€â”€ task_name
â”‚   â””â”€â”€ gflownet_train                                                          
â”œâ”€â”€ tags
â”‚   â””â”€â”€ ['gflownet']                                                            
â”œâ”€â”€ train
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test
â”‚   â””â”€â”€ True                                                                    
â”œâ”€â”€ test_ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ allow_test_without_checkpoint
â”‚   â””â”€â”€ False                                                                   
â”œâ”€â”€ ckpt_path
â”‚   â””â”€â”€ None                                                                    
â”œâ”€â”€ seed
â”‚   â””â”€â”€ 42                                                                      
â”œâ”€â”€ window
â”‚   â””â”€â”€ k_values:                                                               
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       - 100                                                                   
â”‚       - 200                                                                   
â”‚       - 300                                                                   
â”‚       - 400                                                                   
â”‚       rollout_k_values:                                                       
â”‚       - 1                                                                     
â”‚       - 5                                                                     
â”‚       - 10                                                                    
â”‚       - 25                                                                    
â”‚       - 50                                                                    
â”‚       max_hops: 3                                                             
â”‚                                                                               
â”œâ”€â”€ ckpt
â”‚   â””â”€â”€ retriever: logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpo
â”‚       gflownet: null                                                          
â”‚                                                                               
â”œâ”€â”€ dataset
â”‚   â””â”€â”€ name: webqsp                                                            
â”‚       kb: freebase                                                            
â”‚       raw_root: /mnt/data/retrieval_dataset/webqsp/raw/data                   
â”‚       out_dir: /mnt/data/retrieval_dataset/webqsp/normalized                  
â”‚       materialized_dir: /mnt/data/retrieval_dataset/webqsp/materialized       
â”‚       paths:                                                                  
â”‚         vocabulary: /mnt/data/retrieval_dataset/webqsp/materialized/vocabulary
â”‚         embeddings: /mnt/data/retrieval_dataset/webqsp/materialized/embeddings
â”‚         processed: /mnt/data/retrieval_dataset/webqsp/materialized/processed  
â”‚       entity_normalization: none                                              
â”‚       num_topics: 2                                                           
â”‚       topic_pe:                                                               
â”‚         enabled: true                                                         
â”‚         precompute: true                                                      
â”‚         num_rounds: 2                                                         
â”‚         num_reverse_rounds: 2                                                 
â”‚       column_map:                                                             
â”‚         question_id_field: id                                                 
â”‚         question_field: question                                              
â”‚         answer_text_field: answer                                             
â”‚         q_entity_field: q_entity                                              
â”‚         a_entity_field: a_entity                                              
â”‚         graph_field: graph                                                    
â”‚                                                                               
â””â”€â”€ optimized_metric
    â””â”€â”€ val/answer_hit                                                          
Seed set to 42
[[36m2025-12-24 18:17:09,089[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Resolved run name: train_gflownet[0m
[[36m2025-12-24 18:17:09,089[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating datamodule <src.data.g_agent_datamodule.GAgentDataModule>[0m
[[36m2025-12-24 18:17:09,092[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating model <src.models.gflownet_module.GFlowNetModule>[0m
[[36m2025-12-24 18:17:09,187[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating callbacks...[0m
[[36m2025-12-24 18:17:09,187[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.ModelCheckpoint>[0m
[[36m2025-12-24 18:17:09,188[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.EarlyStopping>[0m
[[36m2025-12-24 18:17:09,189[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichModelSummary>[0m
[[36m2025-12-24 18:17:09,189[0m][[34msrc.utils.instantiators[0m][[32mINFO[0m] - [rank: 0] Instantiating callback <lightning.pytorch.callbacks.RichProgressBar>[0m
[[36m2025-12-24 18:17:09,189[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating loggers...[0m
[[36m2025-12-24 18:17:09,189[0m][[34msrc.utils.instantiators[0m][[33mWARNING[0m] - [rank: 0] No logger configs found! Skipping...[0m
[[36m2025-12-24 18:17:09,190[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Instantiating trainer <lightning.pytorch.trainer.Trainer>[0m
Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
[[36m2025-12-24 18:17:09,198[0m][[34m__main__[0m][[32mINFO[0m] - [rank: 0] Starting training![0m
[[36m2025-12-24 18:17:11,225[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/train_g_agent.pt: 2812 samples.[0m
[[36m2025-12-24 18:17:13,331[0m][[34msrc.data.g_agent_dataset[0m][[32mINFO[0m] - Loaded g_agent cache /mnt/data/retrieval_dataset/webqsp/materialized/g_agent/validation_g_agent.pt: 245 samples.[0m
[[36m2025-12-24 18:17:13,803[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/entity_embeddings.pt...[0m
[[36m2025-12-24 18:17:14,761[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Loading /mnt/data/retrieval_dataset/webqsp/materialized/embeddings/relation_embeddings.pt...[0m
[[36m2025-12-24 18:17:14,770[0m][[34msrc.data.components.embedding_store[0m][[32mINFO[0m] - Entity embedding rows: 539675 (vocab entities: 1316464). Non-text entities use embedding_id=0; textual entities occupy 1..max_id.[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”“
â”ƒ    â”ƒ Name                                       â”ƒ Type      â”ƒ Params â”ƒ Mode  â”ƒ
â”¡â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”©
â”‚ 0  â”‚ policy                                     â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 1  â”‚ policy.state_norm                          â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 2  â”‚ policy.q_film                              â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 3  â”‚ policy.q_film.0                            â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 4  â”‚ policy.q_film.1                            â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 5  â”‚ policy.q_film.2                            â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 6  â”‚ policy.direction_embeddings                â”‚ Embedding â”‚  2.0 K â”‚ train â”‚
â”‚ 7  â”‚ policy.edge_proj                           â”‚ Sequentiâ€¦ â”‚  1.1 M â”‚ train â”‚
â”‚ 8  â”‚ policy.edge_proj.0                         â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 9  â”‚ policy.edge_proj.1                         â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 10 â”‚ policy.edge_proj.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 11 â”‚ policy.edge_proj.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 12 â”‚ policy.attn_q                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 13 â”‚ policy.attn_k                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 14 â”‚ policy.attn_v                              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 15 â”‚ policy.edge_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 16 â”‚ policy.edge_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 17 â”‚ policy.edge_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 18 â”‚ policy.edge_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 19 â”‚ policy.edge_head.3                         â”‚ Dropout   â”‚      0 â”‚ train â”‚
â”‚ 20 â”‚ policy.edge_head.4                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 21 â”‚ policy.stop_head                           â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 22 â”‚ policy.stop_head.0                         â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 23 â”‚ policy.stop_head.1                         â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 24 â”‚ policy.stop_head.2                         â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 25 â”‚ policy.stop_head.3                         â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 26 â”‚ reward_fn                                  â”‚ GFlowNetâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 27 â”‚ env                                        â”‚ GraphEnv  â”‚      0 â”‚ train â”‚
â”‚ 28 â”‚ embedder                                   â”‚ GraphEmbâ€¦ â”‚  8.4 M â”‚ train â”‚
â”‚ 29 â”‚ embedder.entity_proj                       â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 30 â”‚ embedder.entity_proj.network               â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 31 â”‚ embedder.entity_proj.network.0             â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 32 â”‚ embedder.entity_proj.network.1             â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 33 â”‚ embedder.relation_proj                     â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 34 â”‚ embedder.relation_proj.network             â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 35 â”‚ embedder.relation_proj.network.0           â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 36 â”‚ embedder.relation_proj.network.1           â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 37 â”‚ embedder.query_proj                        â”‚ Embeddinâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 38 â”‚ embedder.query_proj.network                â”‚ Sequentiâ€¦ â”‚  1.0 M â”‚ train â”‚
â”‚ 39 â”‚ embedder.query_proj.network.0              â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 40 â”‚ embedder.query_proj.network.1              â”‚ Tanh      â”‚      0 â”‚ train â”‚
â”‚ 41 â”‚ embedder.non_text_entity_emb               â”‚ Embedding â”‚  1.0 K â”‚ train â”‚
â”‚ 42 â”‚ embedder._dde                              â”‚ DDE       â”‚      0 â”‚ train â”‚
â”‚ 43 â”‚ embedder._dde.layers                       â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 44 â”‚ embedder._dde.layers.0                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 45 â”‚ embedder._dde.layers.0.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 46 â”‚ embedder._dde.layers.1                     â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 47 â”‚ embedder._dde.layers.1.aggr_module         â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 48 â”‚ embedder._dde.reverse_layers               â”‚ ModuleLiâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 49 â”‚ embedder._dde.reverse_layers.0             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 50 â”‚ embedder._dde.reverse_layers.0.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 51 â”‚ embedder._dde.reverse_layers.1             â”‚ PEConv    â”‚      0 â”‚ train â”‚
â”‚ 52 â”‚ embedder._dde.reverse_layers.1.aggr_module â”‚ MeanAggrâ€¦ â”‚      0 â”‚ train â”‚
â”‚ 53 â”‚ embedder.edge_adapter                      â”‚ Sequentiâ€¦ â”‚  5.3 M â”‚ train â”‚
â”‚ 54 â”‚ embedder.edge_adapter.0                    â”‚ Linear    â”‚  4.2 M â”‚ train â”‚
â”‚ 55 â”‚ embedder.edge_adapter.1                    â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â”‚ 56 â”‚ embedder.edge_adapter.2                    â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 57 â”‚ embedder.edge_adapter.3                    â”‚ Linear    â”‚  1.0 M â”‚ train â”‚
â”‚ 58 â”‚ embedder.edge_score_proj                   â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 59 â”‚ estimator                                  â”‚ GFlowNetâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 60 â”‚ estimator.log_z_head                       â”‚ Sequentiâ€¦ â”‚  2.1 M â”‚ train â”‚
â”‚ 61 â”‚ estimator.log_z_head.0                     â”‚ LayerNorm â”‚  4.1 K â”‚ train â”‚
â”‚ 62 â”‚ estimator.log_z_head.1                     â”‚ Linear    â”‚  2.1 M â”‚ train â”‚
â”‚ 63 â”‚ estimator.log_z_head.2                     â”‚ GELU      â”‚      0 â”‚ train â”‚
â”‚ 64 â”‚ estimator.log_z_head.3                     â”‚ Linear    â”‚  1.0 K â”‚ train â”‚
â”‚ 65 â”‚ actor                                      â”‚ GFlowNetâ€¦ â”‚  9.5 M â”‚ train â”‚
â”‚ 66 â”‚ actor.state_encoder                        â”‚ StateEncâ€¦ â”‚  6.1 K â”‚ train â”‚
â”‚ 67 â”‚ actor.state_encoder.step_embeddings        â”‚ Embedding â”‚  4.1 K â”‚ train â”‚
â”‚ 68 â”‚ actor.state_encoder.norm                   â”‚ LayerNorm â”‚  2.0 K â”‚ train â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
Trainable params: 20.0 M                                                        
Non-trainable params: 0                                                         
Total params: 20.0 M                                                            
Total estimated model params size (MB): 79                                      
Modules in train mode: 69                                                       
Modules in eval mode: 0                                                         
Epoch 54/199                   0/22 0:00:06 â€¢ 0:00:00 0.00it/s train/loss: 2.795
                                                               train/log_reward:
                                                               -1.612           
                                                               train/answer_hit:
                                                               0.458            
[[36m2025-12-24 18:24:04,995[0m][[34msrc.utils.utils[0m][[31mERROR[0m] - [rank: 0] [0m
Traceback (most recent call last):
  File "/mnt/wangjingxiong/EVI-RAG/src/utils/utils.py", line 75, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
                               ^^^^^^^^^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/train.py", line 134, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 560, in fit
    call._call_and_handle_interrupt(
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/call.py", line 49, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 598, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 1011, in _run
    results = self._run_stage()
              ^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 1055, in _run_stage
    self.fit_loop.run()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fit_loop.py", line 216, in run
    self.advance()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fit_loop.py", line 458, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 152, in run
    self.advance(data_fetcher)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 310, in advance
    batch, _, __ = next(data_fetcher)
                   ^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fetchers.py", line 134, in __next__
    batch = super().__next__()
            ^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fetchers.py", line 61, in __next__
    batch = next(self.iterator)
            ^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/combined_loader.py", line 341, in __next__
    out = next(self._iterator)
          ^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/combined_loader.py", line 78, in __next__
    out[i] = next(self.iterators[i])
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 733, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1515, in _next_data
    return self._process_data(data, worker_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1550, in _process_data
    data.reraise()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/_utils.py", line 750, in reraise
    raise exception
ValueError: Caught ValueError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/data/g_agent_dataset.py", line 648, in __getitem__
    record = self._read_jsonl_record(idx)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/data/g_agent_dataset.py", line 671, in _read_jsonl_record
    raise ValueError(f"Empty line at idx={idx}")
ValueError: Empty line at idx=2060

[[36m2025-12-24 18:24:04,997[0m][[34msrc.utils.utils[0m][[32mINFO[0m] - [rank: 0] Output dir: /mnt/wangjingxiong/EVI-RAG/logs/train_gflownet/multiruns/2025-12-24_16-07-06/9[0m
Error executing job with overrides: ['model.actor_cfg.action_topk=50', 'model.reward_cfg.shaping_coef=5.0', 'model.optimizer_cfg.lr=8.898896996100196e-05', 'experiment=train_gflownet', 'hparams_search=gflownet_optuna', 'dataset=webqsp', 'ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt', 'logger=none']
Error executing job with overrides: ['model.actor_cfg.action_topk=50', 'model.reward_cfg.shaping_coef=5.0', 'model.optimizer_cfg.lr=8.898896996100196e-05', 'experiment=train_gflownet', 'hparams_search=gflownet_optuna', 'dataset=webqsp', 'ckpt.retriever=logs/train_retriever_default/runs/2025-12-24_13-39-33/checkpoints/epoch_010.ckpt', 'logger=none']
Traceback (most recent call last):
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
           ^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/_internal/utils.py", line 466, in <lambda>
    lambda: hydra.multirun(
            ^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/_internal/hydra.py", line 162, in multirun
    ret = sweeper.sweep(arguments=task_overrides)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra_plugins/hydra_optuna_sweeper/optuna_sweeper.py", line 52, in sweep
    return self.sweeper.sweep(arguments)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra_plugins/hydra_optuna_sweeper/_impl.py", line 391, in sweep
    raise e
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra_plugins/hydra_optuna_sweeper/_impl.py", line 360, in sweep
    f"Return value must be float-castable. Got '{ret.return_value}'."
                                                 ^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra_plugins/hydra_optuna_sweeper/_impl.py", line 357, in sweep
    values = [float(ret.return_value)]
                    ^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/core/utils.py", line 260, in return_value
    raise self._return_value
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
                       ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/train.py", line 184, in main
    metric_dict, _ = train(cfg)
                     ^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/utils/utils.py", line 85, in wrap
    raise ex
  File "/mnt/wangjingxiong/EVI-RAG/src/utils/utils.py", line 75, in wrap
    metric_dict, object_dict = task_func(cfg=cfg)
                               ^^^^^^^^^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/train.py", line 134, in train
    trainer.fit(model=model, datamodule=datamodule, ckpt_path=cfg.get("ckpt_path"))
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 560, in fit
    call._call_and_handle_interrupt(
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/call.py", line 49, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 598, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 1011, in _run
    results = self._run_stage()
              ^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/trainer/trainer.py", line 1055, in _run_stage
    self.fit_loop.run()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fit_loop.py", line 216, in run
    self.advance()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fit_loop.py", line 458, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 152, in run
    self.advance(data_fetcher)
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 310, in advance
    batch, _, __ = next(data_fetcher)
                   ^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fetchers.py", line 134, in __next__
    batch = super().__next__()
            ^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/loops/fetchers.py", line 61, in __next__
    batch = next(self.iterator)
            ^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/combined_loader.py", line 341, in __next__
    out = next(self._iterator)
          ^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/lightning/pytorch/utilities/combined_loader.py", line 78, in __next__
    out[i] = next(self.iterators[i])
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 733, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1515, in _next_data
    return self._process_data(data, worker_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1550, in _process_data
    data.reraise()
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/_utils.py", line 750, in reraise
    raise exception
ValueError: Caught ValueError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/anaconda3/envs/pog/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/data/g_agent_dataset.py", line 648, in __getitem__
    record = self._read_jsonl_record(idx)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/wangjingxiong/EVI-RAG/src/data/g_agent_dataset.py", line 671, in _read_jsonl_record
    raise ValueError(f"Empty line at idx={idx}")
ValueError: Empty line at idx=2060

